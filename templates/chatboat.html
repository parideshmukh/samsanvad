<!DOCTYPE html>
<html lang="en">
<head>
    <title>Chatbot</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <title>Button Tooltip</title>
    <style>
        body {
            margin: 0px !important;
            color: #fffff;
            background-color: #FFFFFF;
            padding :0;
            font-family: 'Aptos', sans-serif;
        }
        .container {
            display: flex;
            height: 330px;
            width: 100%;
        }

        h1  {
            color: #3498db;
            font-size: 24px;
        }
        h2 {
            color: #3498db;
            font-size: 24px;
        }
         h3 {
            color: #0a027a;
            font-size: 16px;

        }
         h4 {
            color: #3498db;
            font-size: 20px;
        }
        .form-container {
            max-width: 60px;
            height: 30px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0);
            background-color: #FFFFFF;
        }

        .form-container form {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        #chat-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        #previous-chat, #previous-chat-global {
            width: 95%;
            height: 450px;;
            padding: 10px;
            border-radius: 5px;
            margin: 0px 0px;
            background-color: black
            font-color:white
            font-size: 20px;
            font-family: 'Aptos', Times New Roman;
            text-align: left;
            line-height: 1.6;
            display: inline-block;
            float: left;
            overflow-y: auto;
        }
        #previous-chat1 {
            width: 95%;
            height: 450px;
            padding: 10px;
            border-radius: 5px;
            margin: 0px 0px;
            background-color: #00000;
            font-size: 20px;
            font-family: 'Aptos', Times New Roman;
            text-align: left;
            line-height: 1.6;
            display: inline-block;
            float: left;
            overflow-y: auto;
        }

        #previous-chatright-side {
            width: 95%;
            height: 360px;
            padding: 10px
            margin-left: 300px
            background-color: #00000;
            font-size: 20px;
            font-family: 'Aptos', Times New Roman;
            text-align: left;
            line-height: 1.6;
            display: inline-block;
            float: left;

        }

        #chat-question div {
            margin-bottom: 5px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            flot:right;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 5px 0;
            background-color: #00000;
            font-size: 14px;
            font-color:white
            text-align: left;
            display: inline-block;
            font-family: 'Aptos', sans-serif;
             overflow-y: auto;
        }

        form {
            margin-bottom: 15px;
        }

        input[type="text"]{
            width: calc(60% - 65px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #FFFFFF;
            font-family: 'Aptos', Arial;
        }

        input[type="submit"], .generate-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            color: #FFFFFF;
            cursor: pointer;
            font-size: 12px;
            margin-right: 10px;
            transition: background-color 0.3s ease;
            background-color: #739bfa;
            background-color1: #008CBA;
        }
        #chat-form {
            width: 130%;
            margin-top: 5px;
        }
        #user-input {
            width: 50%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 20px;
            font-family: 'Aptos', sans-serif;

        }

        .generate-button:last-of-type {
            margin-right: 0;
        }


        .container2 {
            border-radius: 8px;
            padding: 40px;
            width: 550px;
            text-align: center;
            margin: 5px auto 20px auto;
            background: #000000
            height: 150px;
            margin-bottom: 15px;
            border: 1px solid   #FFFFF;

        }


        .container11 {
            flex:0 1;
            background-color: #00000;
            width: 25%;
            height: 20px;
            flex-direction: column;
            align-items: flex-start;
            padding: 2px;
            box-shadow: 0 0 20px rgba(1, 0, 0, 0);
        }
        .container111{
            background-color: #00000;
            width: 20%;
            height: 120px;
            flex-direction: column;
            align-items: flex-start;
            padding: 40px;

            margin-top:138px

        }
       
        .container21 {
            flex:1 0 50%;
            background-color: #f2f4f5
            width: 100%
            height: 90px;
            flex-direction: column;
            align-items: flex-start;
            padding: 20px;
            
           
        }
        .container22{
            
            display: block;
            width: 100%;
            height: 450px;
            border-radius: 5px;
            background-color: white;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            line-height: 1.6;
            font-size: 20px;
            font-family: 'Aptos', Times New Roman;
            margin-top: 15px;
            margin: 30px 10px;
            overflow-y: auto;
            padding: 10px;
            color :#000000
        }

        .container22 h1 {
            color: #1e1f1f
        }

        #chat-area {
            display: block;
            width: 100%;
            height: 450px;
            border-radius: 5px;
            background-color: white;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            line-height: 1.6;
            font-size: 20px;
            font-family: 'Aptos', Times New Roman;
            margin-top: 15px;
            margin: 30px 10px;
            overflow-y: auto;
            padding: 10px;
            color :#000000
        }
        .message {
            max-width: 80%;
            margin: 10px;
            padding: 5px;
            border-radius: 8px;
            word-wrap: break-word;
            clear: both;
        }
        .user {
            float: right;
            background-color:  #b6f5fa;

        }

        .bot {
            float: left;
            background-color: #FFFFF ;
        }

       
        .form-container {
            margin-top: 60px;
        }
       
        .generate-button {
            background-color:  #008CBA
            color: #fff;
            border: none;
            padding: 8px 8px;
            font-size: 12px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            width:80px
        }
        .generate-buttonNew {
            background-color:  blue
            color: blue
            border: none;
            padding: 8px 8px;
            font-size: 12px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            width:400px
            height:60px
        }
       
        .generate-button:hover {
            background-color: #eb3838;
        }
       
        .chat-history {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(1, 0, 0, 0.1);
            margin-top: 20px;
        }
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 550px;
            top: 100px;
            width: 50%;
            height: 80%;
            background-color: rgba(0, 0, 0, 0);
        }

        .modal-content {
            background-color: #FFFFFF;
            margin: 20 auto;
            padding: 10px;
            border: 2px  red double;
            width: 90%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #008CBA;
            text-decoration: none;
            cursor: pointer;
        }
        #contex-form {
   
                }
       
        textarea {
            width: calc(75% - 70px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #0000000;
            font-family: 'Aptos', sans-serif;
        }
        .button-container {
            display: flex;
            #justify-content: space-around;
            margin-bottom: 15px; /* Adjust as needed */
            color:#65c1f0
        }

        #file_form input[type="file"],
        #file_form input[type="submit"] {
          }
       
        #file_form input[type="file"] {
            margin-bottom: 10px;
            width: 300px;
            border-radius: 5px;
            background-color: #FFFFFF;
            cursor: pointer;
        }
        #file_form input[type="submit"] {
            width: 60%;
            border: none;
            border-radius: 5px;
            background-color: #8c8e8f;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .parent1-container {
            display: flex;
        }

        .parent1-containerNew {

        }

        .container17,
        .container18 {
            margin-right: 5px;
        }
       
        .container17 img {
            width: 65px;
            height: 65px;
            margin-bottom: 1px;
        }

         .container18New {
            width: 50px;
            height: 45px;
            margin-bottom: 1px;
            background-color: #0000;
            border-radius: 5px;
            border-color: coral;
            margin-left:20px
        }
       
        .container18 h4 {
            color: #3498db;
        }
        .container31 {
            margin-top: 67px;
            height: 90px;
            background-color: #ffff;
            display:flex;  
            gap:5px;
        }
        .container34{
            width:20%
            display:flex;

        }
        .container32 {
            color: #eb3838;;
            margin-top: 40px;
            font-size: 18px;
            width:20%
        }
        .container33 {
            color:  #eb3838;;
            margin-top:40px;
            font-size: 18px;
            width:20%
        }
         .container35 {
            color: #2ecc71;
            margin-top: 5px;
            width:20%
        }
        .container35 img{
            width: 30%;
            margin-bottom:20px;
        }
        .footer-container {
            position: fixed;
            bottom: 0; 
            padding: 10px;
            color: #000000; 
        }
        .footer-container a {
            color: #000000; 
            text-decoration: none;
            transition: color 0.3s; 
        }

        .footer-container a:hover {
            color: #ffcc00; 
        }

    </style>
</head>
<body>
    <div class ="container">
        <div class="container11">
            <div class="parent1-container">
                <div class="container17">
                    <img src="/static/logo-removebg-preview.png" alt="Logo"; style ="margin-top: 30px">
                </div>
                <div class="container18">
                      <img src="/static/SAM-SANVAD_Logo_Animation.gif" alt="Animated GIF" width="240" height="120">
                </div>
            </div>
            <div class="button-container">
                <button title="PreviousChat" class="generate-button" onclick="displayChatHistoryForUser('{{ emailId }}')">
                    <i class="fas fa-comments fa-3x" style="font-size:25px;color:white"></i>
                </button>
                <button title="Setting" id="open-settings-btn" class="generate-button">
                    <i class="fas fa-cog fa-small slow-ani" style="font-size:30px;color:white; "></i>
                </button>
                 <button title="help"  class="generate-button" onclick="toggleQuestionSection()()">
                    <i class="fas fa-hands-helping" style="font-size:30px;color:#f7f9fa;background: #FFFFF; align: left;"></i>
                </button>
                 <div id="progress-container" class="progress" style="display: none;">
                <i id="progress-icon" class="fas fa-spinner fa-spin" style="font-size:40px;color: #eb3838 ;margin-left: 80px;margin-top: 5px"></i>
            </div>
            </div>
        <hr width="100%" color="red" />
            <div id="previous-chat1">
                <b> How to write Prompt</b>
                <ul style="list-style-type:circle">
                    <li>Define the Conversation </li>
                    <li>Be as Specific as Possible</li>
                     <li>Specify output format e.g.</li>
                    <UL>
                         <li>List only the top four in the form of a bullet list.</li>
                         <li>Present that information in a table.</li>
                        <li> Present the results as HTML</li>
                        <li>Specify output format e.g.</li>
                         <li>Summarize the Game of Thrones TV series in 50 words </li>
                    </UL>
                    <li>Iterate with multiple attempts </li>
                    <li>Provide Examples </li>
                    <li>Test and Iterate </li>
                    <li>Take Turns </li>
                </ul>
                <br>
            </div>
            <div class="parent-container" style="display: flex; flex-direction: column;">
                <div id="previous-chat" class="chat-history" >
                </div>
            </div>
              
            <div class="footer-container">
                <i class="fas fa-globe"style="margin-right: 5px;"></i><a href="https://www.samsanlabs.com/contact-us/" target="_blank">SAMSAN Technische Labs PVT LTD</a>
            </div>

            <div id="settings-modal" class="modal">
                <div class="modal-content">
                    <span class="close" id="close-settings-btn">&times;</span>
            
                    <table>
                        <tr>
                            <td>
                                <p style="margin-top: 5px; font-size: 18px"><b>Select Document</b>:</p>
                                <form id="file_form" method="POST" action="/upload" enctype="multipart/form-data">
                                    <input type="file" name="file" style="font-size: 18px">
                                    <button title="Upload Document" type="submit" class="generate-button" style="width: 100px; font-size: 18px"><i class="fas fa-upload"></i></button>
                                </form>
                            </td>
                            <td>
                                <p style="margin-top: 5px; font-size: 18px"><b>Upload Logo: </b></p>
                                <form id="logo-from" action="/uploadlogo" method="post" enctype="multipart/form-data" style="background-color: #FFFFFF;">
                                    <input type="file" name="file" style="font-size: 18px">
                                    <button title="Upload Logo" id="Browsing" onclick="show()" class="generate-button" style="width: 100px; font-size: 18px;margin-top:10px;"><i class="fas fa-file-image"></i> </button>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p style="margin-top: 5px; font-size: 18px"><b>Document Title:</b></p>
                                <form id="titel-form">
                                    <input type="text" id="doc-title" name="doc-title" placeholder="Example:Car Interior Document" style="font-size: 18px" required>
                                    <button title="Set Title" type="submit" class="generate-button" style="width: 100px; font-size: 18px"><i class="fas fa-file-alt"></i></button>
                                </form>
                            </td>
                            <td>
                                <p style="margin-bottom: 15px; font-size: 18px"><b>Specify Persona:</b></p>
                                <form id="role-form">
                                    <input type="text" id="user-role" name="user-role" placeholder="Example:CEO" style="font-size: 18px" required>
                                    <button title="Set Persona" type="submit" class="generate-button" style="width: 100px; font-size: 18px"><i class="fas fa-user"></i></button>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div class="container40">
                                    <p style="margin-bottom: 10px; font-size: 18px;"><b>Describe Context:</b></p>
                                    <form id="contex-form" style="display: flex;">
                                        <textarea id="user-context" name="user-context" placeholder="Example:This document is based on car interion" rows="2" style="font-size: 18px; width: 580px;" required></textarea>
                                        <button title="Set Context" type="submit" class="generate-button" style="font-size: 18px; width: 100px; margin-left:10px"><i class="fas fa-comment"></i></button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            


        </div>

        <div class="container21">
            <div class="container31" id="container31">
                <div class="container35" id="container35">
                    <img id="uploadedImage" src="data:image/png;base64,{{ input_image_png }}" alt="Input Image"style="display: {% if input_image_png %}block{% else %}none{% endif %};">
                </div>
                <div class="container32" id="container32"></div>
                <div class="container33" id="container33"></div>
                <div class="container34">
                     <form action="/logout" method="post"style="margin-left: 335px;width:100%; margin-bottom: -90px">
                      <button title="LogOut" type="submit" class="generate-button"style="margin-top : 40px" style="margin-left: 155px">
                          <i class="fas fa-sign-out-alt", style="font-size:30px;color:#f7f9fa; background: #739bfa"></i>
                      </button>
                        </form>
                        <button title="ClearChat" class="generate-button" onclick="clearChatArea()" style="margin-top : 45px ; margin-left: 165px">
                           <i class="fas fa-trash-alt"  style="font-size:30px;color:#f7f9fa; background: #739bfa"></i>
                        </button>
                        <button title="SaveChat" class="generate-button" onclick="saveChatHistory('{{ emailId }}')" style="margin-top : 45px; margin-left: -10px">
                            <i class="fas fa-save"  style="font-size:30px;color:#f7f9fa; background: #739bfa"></i>
                        </button>
                     </div>
            </div>
            <hr width="100%" color="red" />
            <div class="container22" id="container22">
                <div class="container2">
                    {% if name %}
                        <h1>Welcome back to SAM-Sanvad {{ name }}</h1>
                        <h2> How can I help you today? </h2>
                    {% else %}
                        <h1>Welcome to SAM-Sanvad.</h1>
                         <h2> How can I help you today? </h2>
                    {% endif %}
                </div>
            </div>

            <div class="chat-area" id="chat-area" style="display: none;"></div>
            <form id="chat-form">
               <button title="Ask Question" class="generate-button" id="speech-btn"style=" margin-bottom: 10px;margin-left: 10px;font-size: 18px;">
                    <i class='fas fa-microphone-alt' style='font-size:25px;color:#f7f9fa'></i>
                </button>
                <button title="Listen Response" class="generate-button" id ="speakButton" style="margin-top: 5px;margin-left: 10px; font-size: 18px;">
                    <i class="fas fa-play-circle" style="font-size:25px;color:#f7f9fa"></i>
                </button>
               <input type="text" id="user-input" placeholder="Type your Query And click Send Button or press Enter..." required>
                <input type="submit" value="&#x2794" class="generate-button" style="margin-top: 1px; font-size: 20px;background-color: #739bfa;">
            </form>
        </div>

          <div class="container111">
            <hr width="100%" color="red" />
            <div id="previous-chatright-side ">

                <div id="chat-question">

              <b>Example Questions</b><br>
                <div onclick="displayQuestion('provide instruction to get into the cab')">Provide instruction to get into the cab</div>
                <div onclick="displayQuestion('How much time the patch should be pressed during tube repair')">How much time the patch should be pressed during tube repair</div>
                <div onclick="displayQuestion('Please provide summary of Shell  Projects- LNG  Canada')">Please provide summary of Shell Projects- LNG    Canada</div>
                <div onclick="displayQuestion('what is aws kendra ?how it work it ?how use it')">what is aws kendra ?how it work it ?how use it </div>
                <div onclick="displayQuestion('what is LNG  Canada')">what is LNG Canada</div>
            </div>

              <hr width="100%" color="red" />

            <div id="settings-modal" class="modal">
                <div class="modal-content">
                  <span class="close" id="close-settings-btn">&times;</span>
                    <p style="margin-top: 5px; font-size: 18px" ><b>Select File</b>:</p><form id="file_form" method="POST" action="/upload" enctype="multipart/form-data">
                        <input type="file" name="file" style="font-size: 18px">
                        <button type="submit" class="generate-button" style="margin-left: 296px;width:150px;font-size: 18px">Upload</button>
                    </form>
                    <p style="margin-top: 5px;font-size: 18px"><b>Display Title:</b></p><form id="titel-form">
                        <input type="text" id="doc-title" name="doc-title" placeholder="Enter  title of document to be displayed" style="font-size: 18px" required>
                        <button type="submit" class="generate-button" style="margin-left: 150px;width:150px;font-size: 18px">Set Title</button>
                    </form>
                    <p style="margin-bottom: 15px;font-size: 18px"><b>Enter Persona:</b></p><form id="role-form">
                        <input type="text" id="user-role" name="user-role" placeholder="Enter user persona" style="font-size: 18px" required>
                        <button type="submit" class="generate-button" style="margin-left: 150px;width:150px;font-size: 18px">Set Role</button>
                    </form>
                    <div class="container40">
                        <p style="margin-bottom: 2px;font-size: 18px;"><b>Enter Context:</b></p><form id="contex-form">
                            <textarea id="user-context" name="user-context" placeholder="Enter user context" rows="4"  style="font-size: 18px" required></textarea>
                            <button type="submit" class="generate-button" style="margin-left: 27px;font-size: 18px;width:150px;margin-top=-20px;">Set Context</button>
                        </form>
                    </div>
                    <p style="margin-bottom: 1px;font-size: 18px"><b>Upload Logo: </b></p><form id="logo-from" action="/uploadlogo" method="post" enctype="multipart/form-data"style="background-color: #FFFFFF;">
                        <input type="file" name="file" style="font-size: 18px"><button id="Browsing" onclick="show()" class="generate-button"style="margin-left: 255px;width:150px;font-size: 18px">Upload</button>
                    </form>
                </div>
              </div>
        </div>
    </div>  
   
    <script>
        var modal = document.getElementById('settings-modal');
        var openBtn = document.getElementById('open-settings-btn');
        var closeBtn = document.getElementById('close-settings-btn');
        openBtn.onclick = function() {
        modal.style.display = 'block';
        };
        closeBtn.onclick = function() {
        modal.style.display = 'none';
        };
        window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
        };
        const roleForm = document.getElementById('role-form');
        const roleInput = document.getElementById('user-role');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const chatArea = document.getElementById('chat-area');
        const speakButton = document.getElementById('speakButton');
        const speechBtn = document.getElementById('speech-btn');
        const contexForm = document.getElementById('contex-form');
        const contextInput = document.getElementById('user-context');
        const titelForm = document.getElementById('titel-form');
        const titelInput = document.getElementById('doc-title');
        function startProgressBar() {
            const progressIcon = document.getElementById('progress-icon');
            const progressContainer = document.getElementById('progress-container');
           
            progressContainer.style.display = 'block';
            progressIcon.style.display = 'inline-block';
        }
       
        function stopProgressBar() {
            const progressContainer = document.getElementById('progress-container');
            const progressIcon = document.getElementById('progress-icon');
           
            progressContainer.style.display = 'none';
            progressIcon.style.display = 'none';
        }
        let userRole = '';
        speechBtn.addEventListener('click', function() {
            startSpeechToText();
        });

        roleForm.addEventListener('submit', function(e) {
            e.preventDefault();
       
            const userRoleInput = document.getElementById('user-role');
            const userRoleValue = userRoleInput.value.trim();
       
            if (userRoleValue !== "") {
                userRole = userRoleValue;
                console.log("User role set to:", userRole);
                 document.getElementById('container32').innerText = `Role: ${userRoleValue}`;
                console.log("Entered user role: ", userRoleValue);
            } else {
                console.log("Please enter a user role");
                  document.getElementById('container32').innerText = `Role: "User"`;
                console.log("Entered user role: ", userRoleValue);
            }
        }
        );
       
        document.getElementById('titel-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const docTitleInput = document.getElementById('doc-title');
            const enteredDocTitle = docTitleInput.value.trim();
            document.getElementById('container33').innerText = `Document: ${enteredDocTitle}`;
            console.log("Entered document title: ", enteredDocTitle);
        });
        contexForm .addEventListener('submit', function(e) {
            e.preventDefault();
            const contextInput = document.getElementById('user-context');
            const context = contextInput.value.trim();
       
            if (context !== "") {
                contextValue = context;
                console.log("User context set to:", contextValue);
            } else {
                console.log("Please enter a context");
            }
        });
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const userMessage = userInput.value;
            document.getElementById('container22').style.display = 'none';
            document.getElementById('chat-area').style.display = 'inline-block';
            userInput.value = '';
            const contextInput = document.getElementById('user-context');
            const context = contextInput.value.trim();
            chatArea.innerHTML += `<div class="message user"><strong>You:</strong> ${userMessage}<br></div>`;
            startProgressBar();
           
            fetch('/local_chat', {
                method: 'POST',
                body: JSON.stringify({ input_text: userMessage, user_role: userRole , context: context}),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message bot';
                messageContainer.innerHTML = `<strong>SamSanvad:</strong> ${data}<br>`;
                speakButton.onclick = function() {
                    speakText(data);
                };
                chatArea.appendChild(messageContainer);
                chatArea.scrollTop = chatArea.scrollHeight;
                stopProgressBar();
            });
           
        });

        function displayQuestion(question) {
            document.getElementById('container22').style.display = 'none';
            document.getElementById('chat-area').style.display = 'inline-block';
            chatArea.innerHTML += `<div class="message user"><strong>You:</strong> ${question}<br></div>`;
            const contextInput = document.getElementById('user-context');
            const context = contextInput.value.trim();
            startProgressBar();
            fetch('/local_chat', {
                method: 'POST',
                body: JSON.stringify({ input_text: question, user_role: userRole , context: context}),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message bot';
                messageContainer.innerHTML = `<strong>SAMSANVAD:</strong> ${data}<br>`;
                speakButton.onclick = function() {
                    speakText(data);
                };
                chatArea.appendChild(messageContainer);
                chatArea.scrollTop = chatArea.scrollHeight;
                stopProgressBar();
            });
        }


        function toggleQuestionSection() {
            var questionSection = document.getElementById('previous-chat');
            questionSection.style.display = 'none '

            var questionSection1 = document.getElementById('previous-chat1');
            if (questionSection1.style.display === 'none' || questionSection1.style.display === '') {
                questionSection1.style.display = 'block';
            } else {
                questionSection1.style.display = 'none ';
            }
        }
        function sendMessage(message) {
            document.getElementById('container22').style.display = 'none';
            document.getElementById('chat-area').style.display = 'inline-block';
            const contextInput = document.getElementById('user-context');
            const context = contextInput.value.trim();
       
            chatArea.innerHTML += `<div class="message user"><strong>You:</strong> ${message}<br></div>`;
            startProgressBar();
           
            fetch('/local_chat', {
                method: 'POST',
                body: JSON.stringify({ input_text: message, user_role: userRole, context: context}),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message bot';
                messageContainer.innerHTML = `<strong>SAMSANVAD:</strong> ${data}<br>`;
                speakButton.onclick = function() {
                    speakText(data);
                };
                speakText(data);
                chatArea.appendChild(messageContainer);
                chatArea.scrollTop = chatArea.scrollHeight;
                stopProgressBar();
            });
       
            userInput.value = '';
        }
        function speakText(text) {
            var utterance = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(utterance);
        }
       
        function startSpeechToText() {
            var recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onresult = function(event) {
                var transcript = event.results[0][0].transcript;
                sendMessage(transcript);
            };

            recognition.onerror = function(event) {
                console.error("Speech recognition error:", event.error);
            };

            recognition.onend = function() {
                console.log("Speech recognition ended.");
            };
            recognition.start();
        }

        function clearChatArea() {
            const chatArea = document.getElementById('chat-area');
            const isConfirmed = window.confirm("Are you sure you want to clear the chat area?");
                if (isConfirmed) {
                    const chatArea = document.getElementById('chat-area');
                    chatArea.innerHTML = '';
                }
            
        }

        function saveChatHistory(emailId) {
            const today = new Date().toISOString().slice(0, 10);
            let allChatHistory = JSON.parse(localStorage.getItem('allChatHistory')) || {};
            let userChatHistory = allChatHistory[emailId] || {};
            const chatArea = document.getElementById('chat-area');
            const currentChat = chatArea.innerHTML;
            userChatHistory[today] = currentChat;
            allChatHistory[emailId] = userChatHistory;
            localStorage.setItem('allChatHistory', JSON.stringify(allChatHistory));
            alert('Chat history saved for today!');
        }
       
        function displayChatHistoryForUser(emailId) {
            var questionSection1 = document.getElementById('previous-chat1');
            questionSection1.style.display = 'none '
            const allChatHistory = JSON.parse(localStorage.getItem('allChatHistory')) || {};
            const previousChatContainer = document.getElementById('previous-chat');
            previousChatContainer.style.display = (previousChatContainer.style.display === 'none' || previousChatContainer.style.display === '') ? 'block' : 'block';
            if (allChatHistory[emailId]) {
                const chatHistory = allChatHistory[emailId];
                for (const date in chatHistory) {
                    previousChatContainer.innerHTML += `<strong>${date}:</strong><br>${chatHistory[date]}<br>`;
                }
            } else {
                previousChatContainer.innerHTML = 'No chat history found for this user.';
            }
        }        

        let imageShown = false;

        function show() {
            if (!imageShown) {
                document.getElementById('uploadedImage').style.display = "block";
                document.getElementById('Browsing').style.display = "block";
                imageShown = true;
            }
        }      
    </script>
</body>
</html>